import django
from django.conf import settings
django.setup()
import json
from mutualfunds.importers.cas import import_cas
import casparser
data = json.load(open('cas-parsed-miner.json'))
cas_data = casparser.CASParserDataType(data)


from datetime import date, timedelta, datetime
from dateutil.parser import parse as dateparse
from django.db.models import F, Q, Case, When, Sum
from django.utils import timezone
from rapidfuzz import process
import numpy as np
import pandas as pd
from tablib import Dataset
import xirr

from mutualfunds.models import (
    FolioScheme,
    FundScheme,
    Transaction,
    NAVHistory,
    SchemeValue,
    FolioValue,
    PortfolioValue,
)
from mutualfunds.importers.daily_value import (
    DailyValueResource,
    FolioValueResource,
    PortfolioValueResource,
    SchemeValueResource,
)

scheme_dates = {'1': datetime(2019, 12, 5, 0, 0), '2': datetime(2014, 4, 9, 0, 0), '3': datetime(2014, 1, 7, 0, 0), '4': datetime(2011, 4, 1, 0, 0), '5': datetime(2014, 1, 7, 0, 0), '6': datetime(2018, 11, 12, 0, 0), '7': datetime(2022, 5, 9, 0, 0), '8': datetime(2018, 9, 28, 0, 0), '9': datetime(2018, 6, 1, 0, 0), '10': datetime(2011, 4, 1, 0, 0), '11': datetime(2019, 11, 6, 0, 0), '12': datetime(2012, 3, 12, 0, 0), '13': datetime(2012, 2, 21, 0, 0), '14': datetime(2013, 11, 18, 0, 0), '15': datetime(2014, 5, 12, 0, 0), '16': datetime(2013, 9, 11, 0, 0), '17': datetime(2018, 11, 12, 0, 0), '18': datetime(2019, 10, 18, 0, 0), '19': datetime(2021, 3, 5, 0, 0), '20': datetime(2018, 11, 12, 0, 0), '21': datetime(2020, 8, 11, 0, 0), '22': datetime(2020, 10, 1, 0, 0), '23': datetime(2021, 5, 4, 0, 0), '24': datetime(2012, 11, 19, 0, 0), '25': datetime(2010, 8, 31, 0, 0), '26': datetime(2010, 9, 2, 0, 0), '27': datetime(2018, 10, 1, 0, 0), '28': datetime(2020, 9, 4, 0, 0), '29': datetime(2021, 10, 24, 0, 0), '30': datetime(2022, 2, 17, 0, 0), '31': datetime(2019, 7, 30, 0, 0), '32': datetime(2011, 5, 19, 0, 0), '33': datetime(2012, 2, 22,0, 0), '34': datetime(2011, 1, 4, 0, 0), '35': datetime(2018, 1, 2, 0, 0), '36': datetime(2021, 3, 1, 0, 0), '37': datetime(2020, 1, 1, 0, 0), '38': datetime(2020, 2, 6, 0, 0)}
